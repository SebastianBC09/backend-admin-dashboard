# Fortex Design - Backend ğŸš€

[![Node.js](https://img.shields.io/badge/Node.js-v18-blue)](https://nodejs.org)
[![Express](https://img.shields.io/badge/Express-4.21.2-brightgreen)](https://expressjs.com)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-8.14.1-blueviolet)](https://www.postgresql.org)
[![Prisma](https://img.shields.io/badge/Prisma-6.5.0-orange)](https://www.prisma.io)
[![JWT](https://img.shields.io/badge/JWT-9.0.2-yellow)](https://jwt.io)
[![License](https://img.shields.io/badge/License-MIT-green)](LICENSE)

Backend para la administraciÃ³n de tipos y propiedades, evaluando la implementaciÃ³n de autenticaciÃ³n, roles y operaciones CRUD sobre una base de datos relacional.

## ğŸ“‹ Tabla de Contenidos
1. [DescripciÃ³n del Proyecto](#-descripciÃ³n-del-proyecto)
2. [Diagramas de Arquitectura](#-diagramas-de-arquitectura)
3. [Estructura del Proyecto](#-estructura-del-proyecto)
4. [TecnologÃ­as Utilizadas](#-tecnologÃ­as-y-dependencias)
5. [Endpoints](#-api-endpoints)
6. [ConfiguraciÃ³n y Migraciones](#-configuraciÃ³n-y-migraciones)
7. [Despliegue](#-despliegue)
8. [Autor](#-autor)
9. [Licencia](#-licencia)

## ğŸ“ DescripciÃ³n del Proyecto

Este proyecto constituye el backend para la prueba tÃ©cnica de Fortex Design. Su objetivo es gestionar diferentes "tipos" (Persona, OrganizaciÃ³n, Evento, Lugar, etc.) y sus "propiedades" asociadas. Entre sus funcionalidades se incluyen:

- **AutenticaciÃ³n y Roles:** Registro e inicio de sesiÃ³n mediante JWT y bcryptjs, con roles diferenciados (ADMIN y USER).
- **GestiÃ³n de Tipos:** CreaciÃ³n, lectura de tipos, con asignaciÃ³n de propiedades mediante un multi-select.
- **GestiÃ³n de Propiedades:** Operaciones CRUD para propiedades, mostrando nombre, tipo (texto, nÃºmero, fecha, check) y fecha de creaciÃ³n.
- **Manejo de Errores:** Uso de middleware personalizado para capturar y responder adecuadamente ante errores (HTTP 400, 401, 404, 500).

El backend se conecta a una base de datos PostgreSQL y las migraciones se gestionan con Prisma. El despliegue se realiza en Render (u otro servicio similar) y el cÃ³digo fuente se encuentra en GitHub.

## ğŸ“Š Diagramas de Arquitectura

### Arquitectura General
```mermaid
graph TD
    A[Frontend]
    B[Express API Server]
    C[Prisma ORM]
    D[PostgreSQL Database]
    E[Auth Middleware]
    F[JWT Generation]

    A -->|HTTP Requests| B
    B --> E
    E --> F
    B --> C
    C --> D
```

### Flujo de AutenticaciÃ³n y Roles

```mermaid
sequenceDiagram
    participant C as Cliente
    participant A as API Server
    participant DB as Base de Datos
    participant JWT as Servicio JWT

    C->>A: POST /api/auth/login\n{ email, password }
    A->>DB: Buscar usuario por email
    DB-->>A: Usuario (o null)
    alt Credenciales vÃ¡lidas\n(Usuario encontrado y contraseÃ±a correcta)
        A->>JWT: Generar token JWT (userId, role)\n(expiresIn: 1h)
        JWT-->>A: Token JWT
        A-->>C: 200 OK { token, user }
    else\n(Credenciales invÃ¡lidas)
        A-->>C: 401 Unauthorized { message: 'Credenciales invÃ¡lidas' }
    end
```

### Flujo de Operaciones CRUD

```mermaid
sequenceDiagram
    participant C as Cliente
    participant A as API Server
    participant DB as Base de Datos

    C->>A: GET /api/types\n(GET /api/properties)
    A->>DB: Consultar registros y relaciones
    DB-->>A: Datos de Tipos/Propiedades
    A-->>C: Respuesta JSON con la informaciÃ³n
```

## ğŸ“ Estructura del Proyecto

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/         # Controladores para autenticaciÃ³n, tipos y propiedades
â”‚   â”œâ”€â”€ middlewares/         # Middleware de autenticaciÃ³n, manejo de errores, etc.
â”‚   â”œâ”€â”€ routes/              # Rutas de la API
â”‚   â””â”€â”€ services/            # LÃ³gica de negocio y utilidades
â”‚   â””â”€â”€ utils/               # Funciones para construir y verificar el JWT
â”œâ”€â”€ prisma/                  # Archivo schema.prisma y migraciones
â”œâ”€â”€ .env                     # Variables de entorno
â”œâ”€â”€ package.json             # Scripts y dependencias
â””â”€â”€ README.md                # DocumentaciÃ³n del proyecto
```

## ğŸ› ï¸ TecnologÃ­as y Dependencias

| TecnologÃ­a | VersiÃ³n | DescripciÃ³n |
|------------|---------|-------------|
| **Node.js** | v18+ | Entorno de ejecuciÃ³n para JavaScript |
| **Express** | 4.21.2 | Framework web para Node.js |
| **PostgreSQL** | 8.14.1 (pg) | Sistema de gestiÃ³n de bases de datos relacional |
| **Prisma** | 6.5.0 | ORM para Node.js y TypeScript |
| **JWT** | 9.0.2 | AutenticaciÃ³n basada en tokens |
| **bcryptjs** | 3.0.2 | LibrerÃ­a para hash de contraseÃ±as |
| **cors** | 2.8.5 | Middleware para habilitar CORS |
| **dotenv** | 16.4.7 | Carga de variables de entorno |

### DevDependencies
| Dependencia | VersiÃ³n | DescripciÃ³n |
|------------|---------|-------------|
| **nodemon** | 3.1.9 | Reinicio automÃ¡tico durante desarrollo |
| **eslint** | 8.54.0 | Herramienta de linting para JavaScript |
| **prettier** | 3.2.4 | Formateador de cÃ³digo |

## ğŸŒ API Endpoints

### AutenticaciÃ³n

| MÃ©todo | Endpoint | DescripciÃ³n | ParÃ¡metros | Respuesta |
|--------|----------|-------------|------------|-----------|
| POST | `/api/auth/register` | Registra un nuevo usuario | `{ name, email, password, role? }` | `{ user, token }` |
| POST | `/api/auth/login` | Inicia sesiÃ³n | `{ email, password }` | `{ user, token }` |

### Tipos

| MÃ©todo | Endpoint | DescripciÃ³n | ParÃ¡metros | Respuesta |
|--------|----------|-------------|------------|-----------|
| POST | `/api/types` | Crea un nuevo tipo | `{ name, properties: [] }` | `{ id, name, ... }` |
| GET | `/api/types` | Lista todos los tipos | - | `[{ id, name, ... }]` |
| GET | `/api/types/:id` | Obtiene un tipo por ID | `id` (path) | `{ id, name, ... }` |


### Propiedades

| MÃ©todo | Endpoint | DescripciÃ³n | ParÃ¡metros | Respuesta |
|--------|----------|-------------|------------|-----------|
| POST | `/api/properties` | Crea una nueva propiedad | `{ name, type }` | `{ id, name, ... }` |
| GET | `/api/properties` | Lista todas las propiedades | - | `[{ id, name, ... }]` |
| GET | `/api/properties/:id` | Obtiene una propiedad por ID | `id` (path) | `{ id, name, ... }` |

## âš™ï¸ ConfiguraciÃ³n y Migraciones

1. **Configura las Variables de Entorno:**
   Crea un archivo `.env` con el siguiente contenido:
   ```env
   DATABASE_URL=postgresql://user:password@localhost:5432/fortex_db
   JWT_SECRET=tu_secreto_super_seguro
   PORT=4000
   ```

2. **Ejecuta las Migraciones con Prisma:**
   ```bash
   npm run migrate
   npm run generate
   ```

3. **Opcional: Ejecuta el Seed para datos iniciales:**
   ```bash
   npm run seed
   ```

## ğŸš€ Despliegue

### 1. **Instala las Dependencias:**
```bash
npm install
```

### 2. **Ejecuta las Migraciones:**
```bash
npm run migrate
npm run generate
```

### 3. **Inicia el Servidor:**
Para desarrollo:
```bash
npm run dev
```

Para producciÃ³n:
```bash
npm run start
```

### 4. **Configura y Despliega en Render:**
- Conecta el repositorio en Render.
- Define las variables de entorno necesarias.
- Configura el comando de construcciÃ³n: `npm install && npm run generate`
- Configura el comando de inicio: `npm run start`
- El proyecto se desplegarÃ¡ automÃ¡ticamente en el plan Hobby.

## ğŸ‘¨â€ğŸ’» Autor

**Sebastian Ballen C** - *Frontend Developer*

* LinkedIn: [Sebastian B.](https://www.linkedin.com/in/sebastianballencastaneda-softwaredeveloper)
* Email: sebastian.ballenc@gmail.com

---

## ğŸ“„ Licencia

Este proyecto estÃ¡ licenciado bajo la Licencia MIT - vea el archivo [LICENSE](LICENSE) para mÃ¡s detalles.

---

â­ï¸ **Si te resulta Ãºtil este proyecto, Â¡no olvides darle una estrella en GitHub!** â­ï¸
